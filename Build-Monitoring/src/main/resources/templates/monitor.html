<html>
<head>
 <title>Bootstrap Example</title>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
 <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
 <link rel="stylesheet" href="/css/navbar.css">
 <link rel="stylesheet" href="/css/loader.css">
 <link rel="stylesheet" href="/css/config.css">


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
<script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script> 
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"> </script>
<style type="text/css">

</style>   
</head>
<body>
 <nav class="navbar navbar-findcond navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed"
        data-toggle="collapse" data-target="#navbar">
        <span class="sr-only">Toggle navigation</span> <span
        class="icon-bar"></span> <span class="icon-bar"></span> <span
        class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Build Regression Tool</a>
    </div>
    <div class="collapse navbar-collapse" id="navbar">
      <ul class="nav navbar-nav navbar-right">
        <li class="active"><a href="/build/details"><i
          class="fa fa-fw fa-bell-o"></i>Home</a></li>
          <li class="active"><a href="/build/agentstats">Stats<span
            class="sr-only">(current)</span></a></li>
            <li class="dropdown"><a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button" aria-expanded="false">Regression
              <span class="caret"></span>
            </a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/build/monitor">Configuration</a></li>
			  <li><a href="/build/regression">Regression</a></li>
            </ul></li>
          </ul>
        </div>
      </div>
    </nav>

    <br/>
    <br/>
    <br/>
    <br/>

    <div class="container" ng-app="app" ng-controller="myCtrl">
      <form>
      	<div ng-show="isDisabled">
      		<div class="row text-center" style="margin-top: 40px">
      			<div class="page-header">
        			<h1 class="text-muted">Monitoring for Build {{buildNumber}} is going on.</h1>
        			     
      			</div>
      			<button id="singlebutton" type="submit" name="singlebutton" class="btn btn-lg  text- btn-primary" data-toggle="modal"
             data-target="#confirmmodal" ng-click="processData(data,number,date,am_pm,time)">Disable Monitoring</button>
    			
   			 </div>
      	</div>
        <div class="form-group" ng-hide="isDisabled">
          <div class="row">
            <div class="col-sm-4">
              <div>
                <label for="exampleInputEmail1">Build Number</label>
                <input type="buildno" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Build No. (For e.g: 675.1)" ng-model="number" ng-disabled="isDisabled" required>
                <small id="emailHelp" class="form-text text-muted">Please enter the number as mentioned in mail.</small>
              </div>
            </div>
            <div class="col-sm-4">
              <label>Select Date: </label>
              <div id="datepicker" class="input-group date">
                <input class="form-control" type="text" placeholder="click to enter date" ng-model="date"  ng-disabled="isDisabled" jqdatepicker required/>
                <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
              </div>
              <!-- <input type="text" ng-model="date" jqdatepicker /> -->
            </div>
            <div class="col-sm-2">
              <label for="sel1">AM/PM</label>
              <select class="form-control" id="sel1" ng-model="am_pm"  ng-disabled="isDisabled" required>
                <option value="" class="text-muted">--AM / PM--</option>
                <option>PM</option>
                <option>AM</option>
              </select>
            </div>
            <div class="col-sm-2">
              <div>
                <label for="sel1">TIME</label>
                <select class="form-control" id="sel1" ng-model="time" ng-disabled="isDisabled"  required>
                  <option value='' class="text-muted">--Time--</option>
                  <option>12:00</option>
                  <option>12:30</option>

                  <option>01:00</option>
                  <option>01:30</option>

                  <option>02:00</option>
                  <option>02:30</option>

                  <option>03:00</option>
                  <option>03:30</option>

                  <option>04:00</option>
                  <option>04:30</option>

                  <option>05:00</option>
                  <option>05:30</option>

                  <option>06:00</option>
                  <option>06:30</option>

                  <option>07:00</option>
                  <option>07:30</option>

                  <option>08:00</option>
                  <option>08:30</option>

                  <option>09:00</option>
                  <option>09:30</option>

                  <option>10:00</option>
                  <option>10:30</option>

                  <option>11:00</option>
                  <option>11:30</option>

                </select>
              </div>
            </div>
          </div>
          <br/>
          <br/>
          <div class="row">

            <div class="col-sm-12 ">
              <textarea class="form-control" rows="5" id="iparea" ng-model="data" placeholder="{{textarea}}" ng-disabled="isDisabled"></textarea>
              <br/>
            </div>

            <div class="col-md-12 text-center"> 
             <div class="col-md-12 text-center"> 
             <button id="singlebutton" type="submit" name="singlebutton" class="btn btn-lg  text- btn-primary" data-toggle="modal"
             data-target="#{{datatarget}}" ng-click="processData(data,number,date,am_pm,time)" ng-show="!isDisabled">Enable Monitoring</button> 
           </div>

         </div>


       </div>
       </div>
       <div class="modal fade" id="confirmmodal" role="dialog">
        <div class="modal-dialog modal-sm">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title text-center text-muted">Do, you really want to disable the monitoring.?</h4>
            </div>
            <div class="modal-body text-center">
               <button type="button" class="btn btn-success" style="margin: 0 auto" ng-click="deleteData()" data-dismiss="modal">YES</button>
              <button type="button" class="btn btn-danger" style="margin: 0 auto" data-dismiss="modal">NO</button>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
       <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header text-center">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <p class="modal-title text-info" style="margin: 0 auto">BUILD CONFIGURATION CONFIRMATION</p>
              <br/>
              <button type="button" class="btn btn-success" style="margin: 0 auto" ng-click="confirmData()" data-dismiss="modal">YES</button>
              <button type="button" class="btn btn-danger" style="margin: 0 auto" ng-click="isDisabled = false" data-dismiss="modal">NO</button>
            </div>
            <div class="modal-body">
               <table class="table table-bordered table-striped" style="font-size: 12px;width:400px; margin:auto">
                    
                    <tbody>
                      <tr class="info">
                        <td style="font-weight: bold">Build Number :</td>
                        <td>{{number}}</td>
                      </tr>
                      <tr class="info">
                        <td style="font-weight: bold">Build Date :</td>
                        <td>{{date+' '+time+' '+am_pm}}</td>
                      </tr>
                    </tbody>
                  </table>

              <ul style="list-style-type: none;">

                <li ng-repeat="x in configdetails">
                  <h4 class="text-center"><u>{{x[0].environment.toUpperCase()}}</u></h4>
                  <table class="table table-bordered table-striped" style="font-size: 12px; width:300px; margin:auto">
                    <thead>
                      <tr>
                        <th class="text-center">BUILD</th>
                        <th class="text-center">NON BUILD</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr ng-repeat="y in x">
                        <td>{{y.buildIP}}</td>
                        <td>{{y.nonBUildIP}}</td>
                      </tr>
                    </tbody>
                  </table>

                </li>
              </ul>


            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>

        </div>
      </div>
    </form>

  </div>

  <script type="text/javascript">
    var datePicker = angular.module('app', []);
    datePicker.directive('jqdatepicker', function () {
      return {
        restrict: 'A',
        require: 'ngModel',
        link: function (scope, element, attrs, ngModelCtrl) {
          element.datepicker({
            autoclose: true, 
            todayHighlight: true,
            dateFormat: 'DD, d  MM, yy',
            onSelect: function (date) {
              scope.$apply(function () {
                ngModelCtrl.$setViewValue(date);
              });
            }
          }).datepicker('setDate', new Date());
        }
      };
    });
    datePicker.controller('myCtrl', function($scope, $http, $timeout,$location) {
    	$scope.textarea='Paste the ip details here.'
    	$scope.myURL="http://"+$location.host()+":"+$location.port()+"/build/";
    	
    	
    	$http({
            method : "GET",
            url : $scope.myURL+"getbuilddetails"
          }).then(function mySuccess(response) {
        	  $scope.rd=response.data;
        	  var temp = JSON.stringify($scope.rd);
			  $scope.ds=temp;
        	  $scope.$watch('ds', function () {
					if ($scope.ds.match("FNP")) {
						$scope.isDisabled = true;
					} else {
						$scope.isDisabled =false;
					}
				});

          }, function myError(response) {

          });

    //$timeout(callAtTimeout,1000);
    
    $scope.confirmData=function() { 
      $scope.isDisabled = true;
      $http({
        method : "GET",
        url : $scope.myURL+"getbuilddetails?data="+$scope.stats+"&bn="+$scope.buildNumber+"&date="+$scope.date+" "+$scope.time+" "+$scope.am_pm+"&confirm=true"
      }).then(function mySuccess(response) {
      //alert("success");
        $scope.confirmData=response.data;
        $scope.confirmConfigDetails = Object
        .keys($scope.confirmData)
        .map(
          function(value,
            index) {
            return $scope.confirmData[value]
          })

      }, function myError(response) {
      	//alert("http fail");
      });


    }
    
    $scope.deleteData=function() {
    	$scope.textarea='Paste the ip details here.'
        $http({
          method : "GET",
          url : $scope.myURL+"deletebuilddetails?data="+$scope.stats+"&bn="+$scope.buildNumber+"&date="+$scope.date+" "+$scope.time+" "+$scope.am_pm+"&confirm=true"
        }).then(function mySuccess(response) {
          $scope.deletedata=response.data;
          $scope.isDisabled = false;
       
        }, function myError(response) {
        	//alert("http fail");
        });


      }

    $scope.processData=function(stats,number,date,am_pm,time) {
	
    	 
         $scope.buildNumber=number;
         $scope.date=date;
         $scope.am_pm=am_pm;
         $scope.time=time;
      $scope.$watch('ds', function () {
   
        if (number===undefined
          || date===undefined 
          || am_pm===undefined
          || time===undefined) {
        	//alert("if");
         $scope.datatarget=""
     } else {
    	 //alert(stats);
    	//alert("else"); 

      $scope.datatarget="myModal"
      var data='';
      var satsArray=stats.split("\n");
      for(var i=0;i<satsArray.length;i++)
      {

        var finalStats=satsArray[i].split("\t");
        for(var j=0;j<finalStats.length;j++)
        {
          data=data+finalStats[j]+";"
        }
      }
      $scope.stats=data;
      $http({
        method : "GET",
        url : $scope.myURL+"getbuilddetails?data="+data+"&bn="+number+"&date="+date+" "+time+" "+am_pm+"&confirm=false"
      }).then(function mySuccess(response) {
    	//alert("success");
        $scope.conf=response.data;
        $scope.configdetails = Object
        .keys($scope.conf)
        .map(
          function(value,
            index) {
            return $scope.conf[value]
          })

      }, function myError(response) {
			//alert("http fail");
      });

    }
  });


    }
    

      /*$scope.getAgentStats=function(arr) {
        $scope.details=arr;
      };*/
      

      
    });

  </script>
</body>
</html>